"use strict";var Main={};Main.load=function(){window.addEventListener("DOMContentLoaded",function(){var canvas=document.getElementById("renderCanvas"),engine=new BABYLON.Engine(canvas,(!0)),sc=new Scene(engine);sc.createGround(),sc.createSpheres(15),engine.runRenderLoop(function(){sc.render()}),window.addEventListener("resize",function(){engine.resize()}),window.addEventListener("click",function(){sc.createSpheres(5)})})};var Scene=function(engine){this.meshes=[],this.engine=engine,this.scene=new BABYLON.Scene(this.engine),this.scene.ambientColor=new BABYLON.Color3(.3,.3,.3),this.camera=new BABYLON.ArcRotateCamera("camera",3*Math.PI/2,Math.PI/8,50,BABYLON.Vector3.Zero(),this.scene),this.camera.checkCollisions=!0,this.camera.applyGravity=!0,this.camera.setPosition(new BABYLON.Vector3(160,80,100)),this.camera.attachControl(this.engine.getRenderingCanvas(),!0),this.light=new BABYLON.DirectionalLight("light",new BABYLON.Vector3(.2,(-1),0),this.scene),this.light.position=new BABYLON.Vector3(0,80,0),this.groundMat=new BABYLON.StandardMaterial("groundMat",this.scene),this.groundMat.diffuseColor=new BABYLON.Color3(.5,.5,.5),this.groundMat.emissiveColor=new BABYLON.Color3(.2,.2,.2),this.groundMat.backFaceCulling=!1,this.alphaMat=new BABYLON.StandardMaterial("alphaMat",this.scene),this.alphaMat.diffuseColor=BABYLON.Color3.White(),this.alphaMat.alpha=0,this.shadowGenerator=new BABYLON.ShadowGenerator(2048,this.light),this.scene.enablePhysics(null,new BABYLON.CannonJSPlugin),this.scene.onPointerDown=function(evt,pickResult){if(pickResult.hit){var dir=pickResult.pickedPoint.subtract(this.activeCamera.position);dir.normalize(),pickResult.pickedMesh.applyImpulse(dir.scale(20),pickResult.pickedPoint)}}};Scene.prototype.createGround=function(){var width=100,depth=100,height=50,thick=.5,stepHeight=2,parts=[],ground=BABYLON.Mesh.CreateGround("ground",width,depth,1,this.scene);ground.material=this.groundMat,ground.position.y=-20,ground.checkCollisions=!0,ground.receiveShadows=!0,parts.push({mesh:ground,impostor:BABYLON.PhysicsEngine.BoxImpostor});var border0=BABYLON.Mesh.CreateBox("border0",1,this.scene);border0.scaling=new BABYLON.Vector3(thick,height,depth),border0.material=this.alphaMat,border0.position.y=height/2,border0.position.x=-width/2,border0.checkCollisions=!0,border0.parent=ground,parts.push({mesh:border0,impostor:BABYLON.PhysicsEngine.BoxImpostor});var border1=BABYLON.Mesh.CreateBox("border1",1,this.scene);border1.scaling=new BABYLON.Vector3(thick,height,depth),border1.material=this.alphaMat,border1.position.y=height/2,border1.position.x=width/2,border1.checkCollisions=!0,border1.parent=ground,parts.push({mesh:border1,impostor:BABYLON.PhysicsEngine.BoxImpostor});var border2=BABYLON.Mesh.CreateBox("border2",1,this.scene);border2.scaling=new BABYLON.Vector3(width,height,thick),border2.material=this.alphaMat,border2.position.y=height/2,border2.position.z=depth/2,border2.checkCollisions=!0,border2.parent=ground,parts.push({mesh:border2,impostor:BABYLON.PhysicsEngine.BoxImpostor});var border3=BABYLON.Mesh.CreateBox("border3",1,this.scene);border3.scaling=new BABYLON.Vector3(width,height,thick),border3.material=this.alphaMat,border3.position.y=height/2,border3.position.z=-depth/2,border3.checkCollisions=!0,border3.parent=ground,parts.push({mesh:border3,impostor:BABYLON.PhysicsEngine.BoxImpostor});for(var idx=0;idx<9;idx++){var st=BABYLON.Mesh.CreateBox("step"+idx.toString(),1,this.scene);st.scaling=new BABYLON.Vector3(width-3*(idx+5)*stepHeight,stepHeight,depth-3*(idx+5)*stepHeight),st.material=this.groundMat,st.position.y=(idx+1)*stepHeight,st.checkCollisions=!0,st.receiveShadows=!0,this.shadowGenerator.getShadowMap().renderList.push(st),st.parent=ground,parts.push({mesh:st,impostor:BABYLON.PhysicsEngine.BoxImpostor})}this.scene.createCompoundImpostor(parts,{mass:0,friction:.5,restitution:.7})},Scene.prototype.createSpheres=function(num){for(var y=50,index=0;index<num;index++){var sphere=BABYLON.Mesh.CreateSphere("Sphere0",12,3,this.scene);if(sphere.position=new BABYLON.Vector3(20*Math.random()-10,y,10*Math.random()-5),this.shadowGenerator.getShadowMap().renderList.push(sphere),sphere.setPhysicsState(BABYLON.PhysicsEngine.SphereImpostor,{mass:1,friction:.5,restitution:.5}),sphere.applyImpulse(new BABYLON.Vector3(0,(-10),0),sphere.position),this.meshes.push(sphere),this.meshes.length>=50){var toRemove=this.meshes.shift();this.scene.removeMesh(toRemove),toRemove.setPhysicsState(null,null),toRemove.dispose()}y+=2}},Scene.prototype.render=function(){this.scene.render()};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJzY2VuZS5qcyJdLCJuYW1lcyI6WyJNYWluIiwibG9hZCIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZW5naW5lIiwiQkFCWUxPTiIsIkVuZ2luZSIsInNjIiwiU2NlbmUiLCJjcmVhdGVHcm91bmQiLCJjcmVhdGVTcGhlcmVzIiwicnVuUmVuZGVyTG9vcCIsInJlbmRlciIsInJlc2l6ZSIsInRoaXMiLCJtZXNoZXMiLCJzY2VuZSIsImFtYmllbnRDb2xvciIsIkNvbG9yMyIsImNhbWVyYSIsIkFyY1JvdGF0ZUNhbWVyYSIsIk1hdGgiLCJQSSIsIlZlY3RvcjMiLCJaZXJvIiwiY2hlY2tDb2xsaXNpb25zIiwiYXBwbHlHcmF2aXR5Iiwic2V0UG9zaXRpb24iLCJhdHRhY2hDb250cm9sIiwiZ2V0UmVuZGVyaW5nQ2FudmFzIiwibGlnaHQiLCJEaXJlY3Rpb25hbExpZ2h0IiwicG9zaXRpb24iLCJncm91bmRNYXQiLCJTdGFuZGFyZE1hdGVyaWFsIiwiZGlmZnVzZUNvbG9yIiwiZW1pc3NpdmVDb2xvciIsImJhY2tGYWNlQ3VsbGluZyIsImFscGhhTWF0IiwiV2hpdGUiLCJhbHBoYSIsInNoYWRvd0dlbmVyYXRvciIsIlNoYWRvd0dlbmVyYXRvciIsImVuYWJsZVBoeXNpY3MiLCJDYW5ub25KU1BsdWdpbiIsIm9uUG9pbnRlckRvd24iLCJldnQiLCJwaWNrUmVzdWx0IiwiaGl0IiwiZGlyIiwicGlja2VkUG9pbnQiLCJzdWJ0cmFjdCIsImFjdGl2ZUNhbWVyYSIsIm5vcm1hbGl6ZSIsInBpY2tlZE1lc2giLCJhcHBseUltcHVsc2UiLCJzY2FsZSIsInByb3RvdHlwZSIsIndpZHRoIiwiZGVwdGgiLCJoZWlnaHQiLCJ0aGljayIsInN0ZXBIZWlnaHQiLCJwYXJ0cyIsImdyb3VuZCIsIk1lc2giLCJDcmVhdGVHcm91bmQiLCJtYXRlcmlhbCIsInkiLCJyZWNlaXZlU2hhZG93cyIsInB1c2giLCJtZXNoIiwiaW1wb3N0b3IiLCJQaHlzaWNzRW5naW5lIiwiQm94SW1wb3N0b3IiLCJib3JkZXIwIiwiQ3JlYXRlQm94Iiwic2NhbGluZyIsIngiLCJwYXJlbnQiLCJib3JkZXIxIiwiYm9yZGVyMiIsInoiLCJib3JkZXIzIiwiaWR4Iiwic3QiLCJ0b1N0cmluZyIsImdldFNoYWRvd01hcCIsInJlbmRlckxpc3QiLCJjcmVhdGVDb21wb3VuZEltcG9zdG9yIiwibWFzcyIsImZyaWN0aW9uIiwicmVzdGl0dXRpb24iLCJudW0iLCJpbmRleCIsInNwaGVyZSIsIkNyZWF0ZVNwaGVyZSIsInJhbmRvbSIsInNldFBoeXNpY3NTdGF0ZSIsIlNwaGVyZUltcG9zdG9yIiwibGVuZ3RoIiwidG9SZW1vdmUiLCJzaGlmdCIsInJlbW92ZU1lc2giLCJkaXNwb3NlIl0sIm1hcHBpbmdzIjoiQUFHQSxZQUVBLElBQUFBLFFBRUFBLE1BQUFDLEtBQUEsV0FDQUMsT0FBQUMsaUJBQUEsbUJBQUEsV0FDQSxHQUFBQyxRQUFBQyxTQUFBQyxlQUFBLGdCQUNBQyxPQUFBLEdBQUFDLFNBQUFDLE9BQUFMLFNBQUEsSUFHQU0sR0FBQSxHQUFBQyxPQUFBSixPQUVBRyxJQUFBRSxlQUNBRixHQUFBRyxjQUFBLElBRUFOLE9BQUFPLGNBQUEsV0FDQUosR0FBQUssV0FJQWIsT0FBQUMsaUJBQUEsU0FBQSxXQUNBSSxPQUFBUyxXQUdBZCxPQUFBQyxpQkFBQSxRQUFBLFdBQ0FPLEdBQUFHLGNBQUEsT0N4QkEsSUFBQUYsT0FBQSxTQUFBSixRQUVBVSxLQUFBQyxVQUVBRCxLQUFBVixPQUFBQSxPQUVBVSxLQUFBRSxNQUFBLEdBQUFYLFNBQUFHLE1BQUFNLEtBQUFWLFFBRUFVLEtBQUFFLE1BQUFDLGFBQUEsR0FBQVosU0FBQWEsT0FBQSxHQUFBLEdBQUEsSUFJQUosS0FBQUssT0FBQSxHQUFBZCxTQUFBZSxnQkFBQSxTQUFBLEVBQUFDLEtBQUFDLEdBQUEsRUFBQUQsS0FBQUMsR0FBQSxFQUFBLEdBQUFqQixR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LFNBQUFuRSxRQUFBb0UsY0FBQUMsY0FLQTVELEtBQUFFLE1BQUF5RSx1QkFBQTFCLE9BQ0EyQixLQUFBLEVBQ0FDLFNBQUEsR0FDQUMsWUFBQSxNQUtBcEYsTUFBQWlELFVBQUEvQyxjQUFBLFNBQUFtRixLQUVBLElBQUEsR0FEQXpCLEdBQUEsR0FDQTBCLE1BQUEsRUFBQUEsTUFBQUQsSUFBQUMsUUFBQSxDQUNBLEdBQUFDLFFBQUExRixRQUFBNEQsS0FBQStCLGFBQUEsVUFBQSxHQUFBLEVBQUFsRixLQUFBRSxNQVlBLElBVkErRSxPQUFBL0QsU0FBQSxHQUFBM0IsU0FBQWtCLFFBQUEsR0FBQUYsS0FBQTRFLFNBQUEsR0FBQTdCLEVBQUEsR0FBQS9DLEtBQUE0RSxTQUFBLEdBQ0FuRixLQUFBMkIsZ0JBQUE4QyxlQUFBQyxXQUFBbEIsS0FBQXlCLFFBQ0FBLE9BQUFHLGdCQUFBN0YsUUFBQW9FLGNBQUEwQixnQkFDQVQsS0FBQSxFQUNBQyxTQUFBLEdBQ0FDLFlBQUEsS0FHQUcsT0FBQXhDLGFBQUEsR0FBQWxELFNBQUFrQixRQUFBLFFBQUEsR0FBQXdFLE9BQUEvRCxVQUNBbEIsS0FBQUMsT0FBQXVELEtBQUF5QixRQUNBakYsS0FBQUMsT0FBQXFGLFFBQUEsR0FBQSxDQUNBLEdBQUFDLFVBQUF2RixLQUFBQyxPQUFBdUYsT0FDQXhGLE1BQUFFLE1BQUF1RixXQUFBRixVQUNBQSxTQUFBSCxnQkFBQSxLQUFBLE1BQ0FHLFNBQUFHLFVBRUFwQyxHQUFBLElBSUE1RCxNQUFBaUQsVUFBQTdDLE9BQUEsV0FDQUUsS0FBQUUsTUFBQUoiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgQkFCWUxPTiAqL1xuLyogZ2xvYmFsIFNjZW5lICovXG5cbid1c2Ugc3RyaWN0JztcblxudmFyIE1haW4gPSB7fTtcblxuTWFpbi5sb2FkID0gZnVuY3Rpb24oKSB7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW5kZXJDYW52YXMnKTtcbiAgICB2YXIgZW5naW5lID0gbmV3IEJBQllMT04uRW5naW5lKGNhbnZhcywgdHJ1ZSk7XG5cbiAgICAvLyBjcmVhdGUgU2NlbmUgT2JqZWN0XG4gICAgdmFyIHNjID0gbmV3IFNjZW5lKGVuZ2luZSk7XG5cbiAgICBzYy5jcmVhdGVHcm91bmQoKTtcbiAgICBzYy5jcmVhdGVTcGhlcmVzKDE1KTtcbiAgICAvLyBSZW5kZXIgbG9vcFxuICAgIGVuZ2luZS5ydW5SZW5kZXJMb29wKGZ1bmN0aW9uKCkge1xuICAgICAgc2MucmVuZGVyKCk7XG4gICAgfSk7XG5cbiAgICAvLyBSZXNpemVcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24oKSB7XG4gICAgICBlbmdpbmUucmVzaXplKCk7XG4gICAgfSk7XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgIHNjLmNyZWF0ZVNwaGVyZXMoNSk7XG4gICAgfSk7XG4gIH0pO1xufTtcbiIsIi8qIGdsb2JhbCBCQUJZTE9OICovXG5cbid1c2UgcmVzdHJpY3QnO1xuXG52YXIgU2NlbmUgPSBmdW5jdGlvbihlbmdpbmUpIHtcblxuICB0aGlzLm1lc2hlcyA9IFtdO1xuXG4gIHRoaXMuZW5naW5lID0gZW5naW5lO1xuXG4gIHRoaXMuc2NlbmUgPSBuZXcgQkFCWUxPTi5TY2VuZSh0aGlzLmVuZ2luZSk7XG4gIC8vdGhpcy5zY2VuZS5jbGVhckNvbG9yID0gbmV3IEJBQllMT04uQ29sb3IzKDAuMywgMC4zLCAwLjMpO1xuICB0aGlzLnNjZW5lLmFtYmllbnRDb2xvciA9IG5ldyBCQUJZTE9OLkNvbG9yMygwLjMsIDAuMywgMC4zKTtcblxuICAvLyBDYW1lcmFcbiAgLy8gdGhpcy5jYW1lcmEgPSBuZXcgQkFCWUxPTi5GcmVlQ2FtZXJhKCdjYW1lcmEnLCBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDAsIC0yMCksIHRoaXMuc2NlbmUpO1xuICB0aGlzLmNhbWVyYSA9IG5ldyBCQUJZTE9OLkFyY1JvdGF0ZUNhbWVyYSgnY2FtZXJhJywgMyAqIE1hdGguUEkgLyAyLCBNYXRoLlBJIC8gOCwgNTAsIEJBQllMT04uVmVjdG9yMy5aZXJvKCksIHRoaXMuc2NlbmUpO1xuICB0aGlzLmNhbWVyYS5jaGVja0NvbGxpc2lvbnMgPSB0cnVlO1xuICB0aGlzLmNhbWVyYS5hcHBseUdyYXZpdHkgPSB0cnVlO1xuICAvL3RoaXMuY2FtZXJhLnNldFRhcmdldChuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDEwMCwgLTMwKSk7XG4gIHRoaXMuY2FtZXJhLnNldFBvc2l0aW9uKG5ldyBCQUJZTE9OLlZlY3RvcjMoMTYwLCA4MCwgMTAwKSk7XG4gIHRoaXMuY2FtZXJhLmF0dGFjaENvbnRyb2wodGhpcy5lbmdpbmUuZ2V0UmVuZGVyaW5nQ2FudmFzKCksIHRydWUpO1xuXG4gIC8vIExpZ2h0XG4gIHRoaXMubGlnaHQgPSBuZXcgQkFCWUxPTi5EaXJlY3Rpb25hbExpZ2h0KCdsaWdodCcsIG5ldyBCQUJZTE9OLlZlY3RvcjMoMC4yLCAtMSwgMCksIHRoaXMuc2NlbmUpO1xuICB0aGlzLmxpZ2h0LnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygwLCA4MCwgMCk7XG5cbiAgLy8gTWF0ZXJpYWxzXG4gIHRoaXMuZ3JvdW5kTWF0ID0gbmV3IEJBQllMT04uU3RhbmRhcmRNYXRlcmlhbCgnZ3JvdW5kTWF0JywgdGhpcy5zY2VuZSk7XG4gIHRoaXMuZ3JvdW5kTWF0LmRpZmZ1c2VDb2xvciA9IG5ldyBCQUJZTE9OLkNvbG9yMygwLjUsIDAuNSwgMC41KTtcbiAgdGhpcy5ncm91bmRNYXQuZW1pc3NpdmVDb2xvciA9IG5ldyBCQUJZTE9OLkNvbG9yMygwLjIsIDAuMiwgMC4yKTtcbiAgdGhpcy5ncm91bmRNYXQuYmFja0ZhY2VDdWxsaW5nID0gZmFsc2U7XG5cbiAgdGhpcy5hbHBoYU1hdCA9IG5ldyBCQUJZTE9OLlN0YW5kYXJkTWF0ZXJpYWwoJ2FscGhhTWF0JywgdGhpcy5zY2VuZSk7XG4gIHRoaXMuYWxwaGFNYXQuZGlmZnVzZUNvbG9yID0gQkFCWUxPTi5Db2xvcjMuV2hpdGUoKTtcbiAgdGhpcy5hbHBoYU1hdC5hbHBoYSA9IDA7XG5cbiAgLy8gU2hhZG93c1xuICB0aGlzLnNoYWRvd0dlbmVyYXRvciA9IG5ldyBCQUJZTE9OLlNoYWRvd0dlbmVyYXRvcigyMDQ4LCB0aGlzLmxpZ2h0KTtcblxuICAvLyBQaHlzaWNzXG4gIHRoaXMuc2NlbmUuZW5hYmxlUGh5c2ljcyhudWxsLCBuZXcgQkFCWUxPTi5DYW5ub25KU1BsdWdpbigpKTtcblxuICAvLyBFdmVudHNcbiAgdGhpcy5zY2VuZS5vblBvaW50ZXJEb3duID0gZnVuY3Rpb24oZXZ0LCBwaWNrUmVzdWx0KSB7XG4gICAgaWYgKHBpY2tSZXN1bHQuaGl0KSB7XG4gICAgICB2YXIgZGlyID0gcGlja1Jlc3VsdC5waWNrZWRQb2ludC5zdWJ0cmFjdCh0aGlzLmFjdGl2ZUNhbWVyYS5wb3NpdGlvbik7XG4gICAgICBkaXIubm9ybWFsaXplKCk7XG4gICAgICBwaWNrUmVzdWx0LnBpY2tlZE1lc2guYXBwbHlJbXB1bHNlKGRpci5zY2FsZSgyMCksIHBpY2tSZXN1bHQucGlja2VkUG9pbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL3RoaXMuY3JlYXRlU3BoZXJlcyg0KTtcbiAgICB9XG4gIH07XG5cbn07XG5cblNjZW5lLnByb3RvdHlwZS5jcmVhdGVHcm91bmQgPSBmdW5jdGlvbigpIHtcblxuICB2YXIgd2lkdGggPSAxMDAuMDtcbiAgdmFyIGRlcHRoID0gMTAwLjA7XG4gIHZhciBoZWlnaHQgPSA1MC4wO1xuICB2YXIgdGhpY2sgPSAwLjU7XG4gIHZhciBzdGVwSGVpZ2h0ID0gMi4wO1xuXG4gIHZhciBwYXJ0cyA9IFtdO1xuXG4gIC8vIEdyb3VuZFxuICB2YXIgZ3JvdW5kID0gQkFCWUxPTi5NZXNoLkNyZWF0ZUdyb3VuZCgnZ3JvdW5kJywgd2lkdGgsIGRlcHRoLCAxLCB0aGlzLnNjZW5lKTtcbiAgZ3JvdW5kLm1hdGVyaWFsID0gdGhpcy5ncm91bmRNYXQ7XG4gIGdyb3VuZC5wb3NpdGlvbi55ID0gLTIwO1xuICBncm91bmQuY2hlY2tDb2xsaXNpb25zID0gdHJ1ZTtcbiAgZ3JvdW5kLnJlY2VpdmVTaGFkb3dzID0gdHJ1ZTtcbiAgcGFydHMucHVzaCh7XG4gICAgbWVzaDogZ3JvdW5kLFxuICAgIGltcG9zdG9yOiBCQUJZTE9OLlBoeXNpY3NFbmdpbmUuQm94SW1wb3N0b3JcbiAgfSk7XG5cbiAgdmFyIGJvcmRlcjAgPSBCQUJZTE9OLk1lc2guQ3JlYXRlQm94KCdib3JkZXIwJywgMSwgdGhpcy5zY2VuZSk7XG4gIGJvcmRlcjAuc2NhbGluZyA9IG5ldyBCQUJZTE9OLlZlY3RvcjModGhpY2ssIGhlaWdodCwgZGVwdGgpO1xuICBib3JkZXIwLm1hdGVyaWFsID0gdGhpcy5hbHBoYU1hdDtcbiAgYm9yZGVyMC5wb3NpdGlvbi55ID0gaGVpZ2h0IC8gMjtcbiAgYm9yZGVyMC5wb3NpdGlvbi54ID0gLXdpZHRoIC8gMjtcbiAgYm9yZGVyMC5jaGVja0NvbGxpc2lvbnMgPSB0cnVlO1xuICBib3JkZXIwLnBhcmVudCA9IGdyb3VuZDtcbiAgcGFydHMucHVzaCh7XG4gICAgbWVzaDogYm9yZGVyMCxcbiAgICBpbXBvc3RvcjogQkFCWUxPTi5QaHlzaWNzRW5naW5lLkJveEltcG9zdG9yXG4gIH0pO1xuXG4gIHZhciBib3JkZXIxID0gQkFCWUxPTi5NZXNoLkNyZWF0ZUJveCgnYm9yZGVyMScsIDEsIHRoaXMuc2NlbmUpO1xuICBib3JkZXIxLnNjYWxpbmcgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKHRoaWNrLCBoZWlnaHQsIGRlcHRoKTtcbiAgYm9yZGVyMS5tYXRlcmlhbCA9IHRoaXMuYWxwaGFNYXQ7XG4gIGJvcmRlcjEucG9zaXRpb24ueSA9IGhlaWdodCAvIDI7XG4gIGJvcmRlcjEucG9zaXRpb24ueCA9IHdpZHRoIC8gMjtcbiAgYm9yZGVyMS5jaGVja0NvbGxpc2lvbnMgPSB0cnVlO1xuICBib3JkZXIxLnBhcmVudCA9IGdyb3VuZDtcbiAgcGFydHMucHVzaCh7XG4gICAgbWVzaDogYm9yZGVyMSxcbiAgICBpbXBvc3RvcjogQkFCWUxPTi5QaHlzaWNzRW5naW5lLkJveEltcG9zdG9yXG4gIH0pO1xuXG5cbiAgdmFyIGJvcmRlcjIgPSBCQUJZTE9OLk1lc2guQ3JlYXRlQm94KCdib3JkZXIyJywgMSwgdGhpcy5zY2VuZSk7XG4gIGJvcmRlcjIuc2NhbGluZyA9IG5ldyBCQUJZTE9OLlZlY3RvcjMod2lkdGgsIGhlaWdodCwgdGhpY2spO1xuICBib3JkZXIyLm1hdGVyaWFsID0gdGhpcy5hbHBoYU1hdDtcbiAgYm9yZGVyMi5wb3NpdGlvbi55ID0gaGVpZ2h0IC8gMjtcbiAgYm9yZGVyMi5wb3NpdGlvbi56ID0gZGVwdGggLyAyO1xuICBib3JkZXIyLmNoZWNrQ29sbGlzaW9ucyA9IHRydWU7XG4gIGJvcmRlcjIucGFyZW50ID0gZ3JvdW5kO1xuICBwYXJ0cy5wdXNoKHtcbiAgICBtZXNoOiBib3JkZXIyLFxuICAgIGltcG9zdG9yOiBCQUJZTE9OLlBoeXNpY3NFbmdpbmUuQm94SW1wb3N0b3JcbiAgfSk7XG5cblxuICB2YXIgYm9yZGVyMyA9IEJBQllMT04uTWVzaC5DcmVhdGVCb3goJ2JvcmRlcjMnLCAxLCB0aGlzLnNjZW5lKTtcbiAgYm9yZGVyMy5zY2FsaW5nID0gbmV3IEJBQllMT04uVmVjdG9yMyh3aWR0aCwgaGVpZ2h0LCB0aGljayk7XG4gIGJvcmRlcjMubWF0ZXJpYWwgPSB0aGlzLmFscGhhTWF0O1xuICBib3JkZXIzLnBvc2l0aW9uLnkgPSBoZWlnaHQgLyAyO1xuICBib3JkZXIzLnBvc2l0aW9uLnogPSAtZGVwdGggLyAyO1xuICBib3JkZXIzLmNoZWNrQ29sbGlzaW9ucyA9IHRydWU7XG4gIGJvcmRlcjMucGFyZW50ID0gZ3JvdW5kO1xuICBwYXJ0cy5wdXNoKHtcbiAgICBtZXNoOiBib3JkZXIzLFxuICAgIGltcG9zdG9yOiBCQUJZTE9OLlBoeXNpY3NFbmdpbmUuQm94SW1wb3N0b3JcbiAgfSk7XG5cbiAgLy8gU3RlcHNcbiAgZm9yICh2YXIgaWR4ID0gMDsgaWR4IDwgOTsgaWR4KyspIHtcbiAgICB2YXIgc3QgPSBCQUJZTE9OLk1lc2guQ3JlYXRlQm94KCdzdGVwJyArIGlkeC50b1N0cmluZygpLCAxLCB0aGlzLnNjZW5lKTtcbiAgICBzdC5zY2FsaW5nID0gbmV3IEJBQllMT04uVmVjdG9yMyh3aWR0aCAtIDMgKiAoaWR4ICsgNSkgKiBzdGVwSGVpZ2h0LCBzdGVwSGVpZ2h0LCBkZXB0aCAtIDMgKiAoaWR4ICsgNSkgKiBzdGVwSGVpZ2h0KTtcbiAgICBzdC5tYXRlcmlhbCA9IHRoaXMuZ3JvdW5kTWF0O1xuICAgIHN0LnBvc2l0aW9uLnkgPSAoaWR4ICsgMSkgKiBzdGVwSGVpZ2h0O1xuICAgIHN0LmNoZWNrQ29sbGlzaW9ucyA9IHRydWU7XG4gICAgc3QucmVjZWl2ZVNoYWRvd3MgPSB0cnVlO1xuICAgIHRoaXMuc2hhZG93R2VuZXJhdG9yLmdldFNoYWRvd01hcCgpLnJlbmRlckxpc3QucHVzaChzdCk7XG4gICAgc3QucGFyZW50ID0gZ3JvdW5kO1xuICAgIHBhcnRzLnB1c2goe1xuICAgICAgbWVzaDogc3QsXG4gICAgICBpbXBvc3RvcjogQkFCWUxPTi5QaHlzaWNzRW5naW5lLkJveEltcG9zdG9yXG4gICAgfSk7XG4gIH1cblxuICAvLyBwaHlzaWNzIFxuICB0aGlzLnNjZW5lLmNyZWF0ZUNvbXBvdW5kSW1wb3N0b3IocGFydHMsIHtcbiAgICBtYXNzOiAwLFxuICAgIGZyaWN0aW9uOiAwLjUsXG4gICAgcmVzdGl0dXRpb246IDAuN1xuICB9KTtcblxufTtcblxuU2NlbmUucHJvdG90eXBlLmNyZWF0ZVNwaGVyZXMgPSBmdW5jdGlvbihudW0pIHtcbiAgdmFyIHkgPSA1MDtcbiAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IG51bTsgaW5kZXgrKykge1xuICAgIHZhciBzcGhlcmUgPSBCQUJZTE9OLk1lc2guQ3JlYXRlU3BoZXJlKCdTcGhlcmUwJywgMTIsIDMsIHRoaXMuc2NlbmUpO1xuICAgIC8vc3BoZXJlLm1hdGVyaWFsID0gdGhpcy5hbHBoYU1hdDtcbiAgICBzcGhlcmUucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKE1hdGgucmFuZG9tKCkgKiAyMCAtIDEwLCB5LCBNYXRoLnJhbmRvbSgpICogMTAgLSA1KTtcbiAgICB0aGlzLnNoYWRvd0dlbmVyYXRvci5nZXRTaGFkb3dNYXAoKS5yZW5kZXJMaXN0LnB1c2goc3BoZXJlKTtcbiAgICBzcGhlcmUuc2V0UGh5c2ljc1N0YXRlKEJBQllMT04uUGh5c2ljc0VuZ2luZS5TcGhlcmVJbXBvc3Rvciwge1xuICAgICAgbWFzczogMSxcbiAgICAgIGZyaWN0aW9uOiAwLjUsXG4gICAgICByZXN0aXR1dGlvbjogMC41XG4gICAgfSk7XG4gICAgLy8gYWRkIGZvcmNlXG4gICAgc3BoZXJlLmFwcGx5SW1wdWxzZShuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIC0xMCwgMCksIHNwaGVyZS5wb3NpdGlvbik7XG4gICAgdGhpcy5tZXNoZXMucHVzaChzcGhlcmUpO1xuICAgIGlmICh0aGlzLm1lc2hlcy5sZW5ndGggPj0gNTApIHtcbiAgICAgIHZhciB0b1JlbW92ZSA9IHRoaXMubWVzaGVzLnNoaWZ0KCk7XG4gICAgICB0aGlzLnNjZW5lLnJlbW92ZU1lc2godG9SZW1vdmUpO1xuICAgICAgdG9SZW1vdmUuc2V0UGh5c2ljc1N0YXRlKG51bGwsIG51bGwpO1xuICAgICAgdG9SZW1vdmUuZGlzcG9zZSgpO1xuICAgIH1cbiAgICB5ICs9IDI7XG4gIH1cbn07XG5cblNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5zY2VuZS5yZW5kZXIoKTtcbn07XG4iXX0=
